

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Two-node examples (OUT OF DATE) &mdash; ch_frb_l1  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Config reference: L1 server" href="l1_config_reference/index.html" />
    <link rel="prev" title="L1 streams" href="l1_streams.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ch_frb_l1
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help_my_pipeline_is_broken.html">Help! My pipeline is broken</a></li>
<li class="toctree-l1"><a class="reference internal" href="../todo/index.html">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_offline_analysis_scripts/index.html">Example Offline Analysis Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drao/index.html">DRAO computing environment</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Real-Time L1 Server</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="high_level_overview.html">High-level overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="quick_start_examples.html">Quick-start examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration_file_overview.html">Configuration file overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="l1_streams.html">L1 streams</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Two-node examples (OUT OF DATE)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-3">Example 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-4">Example 4</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="l1_config_reference/index.html">Config reference: L1 server</a></li>
<li class="toctree-l2"><a class="reference internal" href="l0_config_reference.html">Config reference: L0 simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="rpc_reference.html">RPC reference</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ch_frb_l1</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">The Real-Time L1 Server</a> &raquo;</li>
        
      <li>Two-node examples (OUT OF DATE)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="two-node-examples-out-of-date">
<h1>Two-node examples (OUT OF DATE)<a class="headerlink" href="#two-node-examples-out-of-date" title="Permalink to this headline">¶</a></h1>
<p><strong>This part of the manual is out of date, and should be ignored until updated!</strong></p>
<p>For now, the “two-node McGill backend” refers to the network below.
The nodes are in a non-link-bonded configuration, with each of their four
1 Gbps NIC’s on a separate /24 network.</p>
<a class="reference internal image-reference" href="../_images/two_node_backend.png"><img alt="../_images/two_node_backend.png" src="../_images/two_node_backend.png" style="width: 890px; height: 318px;" /></a>
<p>Future versions of the manual will include examples which include
more machines, for example a file server.</p>
<div class="section" id="example-3">
<h2>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul>
<li><p class="first">This is a 16-beam production-scale example.  It uses “placeholder” RFI removal
(which detrends the data but doesn’t actually remove RFI), and the least optimal
bonsai configuaration (no low-DM upsampled tree or spectral index search).  As
remarked above, this is currently the best we can do with 16 beams/node, due to
the RFI removal running slower than originally hoped!</p>
</li>
<li><p class="first">This is a two-node example, with the L0 simulator running on frb-compute-0,
and the L1 server running on frb-compute-1.  We process 16 beams with 16384
frequency channels and 1 ms sampling.  The total bandwidth is 2.2 Gbps,
distributed on 4x1 Gbps NIC’s by assigning four beams to each NIC.</p>
</li>
<li><p class="first">Because of the “slow start” problem described previously in <a class="reference internal" href="high_level_overview.html#caveats"><span class="std std-ref">Caveats</span></a>,
this example is now a 20-minute run (previously, it was a 5-minute run).</p>
</li>
<li><p class="first">First, check that the node is in the network configuration shown above.
This is not guaranteed to be the case, since we’re still experimenting with
alternate network configurations!  You can check the configuration by doing <code class="docutils literal"><span class="pre">ifconfig</span> <span class="pre">-a</span></code>
on each node, and checking that the IP addresses of each built-in gigabit NIC (eno*)
are as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">|</span>      <span class="o">|</span> <span class="n">frb</span><span class="o">-</span><span class="n">compute</span><span class="o">-</span><span class="mi">0</span> <span class="o">|</span> <span class="n">frb</span><span class="o">-</span><span class="n">compute</span><span class="o">-</span><span class="mi">1</span>  <span class="o">|</span>
<span class="o">|------|---------------|----------------|</span>
<span class="o">|</span> <span class="n">eno1</span> <span class="o">|</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">1.100</span>    <span class="o">|</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">1.101</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">eno2</span> <span class="o">|</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">2.100</span>    <span class="o">|</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">2.101</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">eno3</span> <span class="o">|</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">3.100</span>    <span class="o">|</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">3.101</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">eno4</span> <span class="o">|</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">4.100</span>    <span class="o">|</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">4.101</span>     <span class="o">|</span>
</pre></div>
</div>
</li>
<li><p class="first">On <code class="docutils literal"><span class="pre">frb-compute-1</span></code>, start the L1 server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">ch</span><span class="o">-</span><span class="n">frb</span><span class="o">-</span><span class="n">l1</span>  \
   <span class="n">l1_configs</span><span class="o">/</span><span class="n">l1_example3</span><span class="o">.</span><span class="n">yaml</span>  \
   <span class="n">rfi_configs</span><span class="o">/</span><span class="n">rfi_placeholder</span><span class="o">.</span><span class="n">json</span>  \
   <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">bonsai_configs</span><span class="o">/</span><span class="n">bonsai_production_noups_nbeta1_v2</span><span class="o">.</span><span class="n">hdf5</span>  \
   <span class="n">l1b_config_placeholder</span>
</pre></div>
</div>
<p>It may take around 30 seconds for all threads and processes to start!
Before going on to the next step, you should wait until messages of the
form “toy-l1b.py: starting…” appear.</p>
<p>Note: On frb-compute-1 and the other CHIME nodes, the bonsai “production” HDF5 files have
been precomputed for convenience, and are kept in <cite>/data/bonsai_configs</cite>.  This is why
we were able to skip the step of computing the .hdf5 file
from <cite>bonsai_configs/bonsai_production_noups_nbeta1_v2.txt</cite>.</p>
</li>
<li><p class="first">On <code class="docutils literal"><span class="pre">frb-compute-0</span></code>, start the L0 simulator:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">ch</span><span class="o">-</span><span class="n">frb</span><span class="o">-</span><span class="n">simulate</span><span class="o">-</span><span class="n">l0</span> <span class="n">l0_configs</span><span class="o">/</span><span class="n">l0_example3</span><span class="o">.</span><span class="n">yaml</span> <span class="mi">1200</span>
</pre></div>
</div>
<p>This simulates 20 minutes of data.  If you switch back to the L1 server window,
you’ll see some incremental output every 10 seconds or so, as coarse-grained triggers
are received by the toy-l1b processes.</p>
</li>
<li><p class="first">When the simulation ends (after 5 minutes), the toy-l1b processes will write
their trigger plots (toy_l1b_beam*.png).  These will be large files (20000-by-4000 pixels)!</p>
</li>
</ul>
</div></blockquote>
<p><strong>Notes on the two-node backend:</strong></p>
<blockquote>
<div><ul>
<li><p class="first">Right now the following ports are open on the firewalls of the compute nodes: 5555/tcp, 6677/udp, 6677/tcp.
If you need to open more, the syntax is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">10252</span><span class="o">/</span><span class="n">udp</span> <span class="o">--</span><span class="n">permanent</span>
<span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">reload</span>
<span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="nb">list</span><span class="o">-</span><span class="nb">all</span>
</pre></div>
</div>
</li>
<li><p class="first">You may run into a nuisance issue where the L1 process hangs for a long time (uninterruptible with control-C)
after throwing an exception, because it is trying to write its core dump.  My solution is
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">killall</span> <span class="pre">-9</span> <span class="pre">abrt-hook-ccpp</span></code> in another window.  Let me know if you find a better one!</p>
<p>A related issue: core dumps can easily fill the / filesystem.  My solution here is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">su</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">spool</span><span class="o">/</span><span class="n">abrt</span><span class="o">/</span><span class="n">ccpp</span><span class="o">*</span>
<span class="n">exit</span>
</pre></div>
</div>
<p>…but be careful with rm -rf as root!</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="example-4">
<h2>Example 4<a class="headerlink" href="#example-4" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul>
<li><p class="first">This is an 8-beam production-scale example.  It uses a real RFI removal scheme developed by Masoud, and the most optimal
bonsai configuration (with a low-DM upsampled tree and two trial spectral indices).</p>
</li>
<li><p class="first">On <code class="docutils literal"><span class="pre">frb-compute-1</span></code>, start the L1 server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">ch</span><span class="o">-</span><span class="n">frb</span><span class="o">-</span><span class="n">l1</span>  \
   <span class="n">l1_configs</span><span class="o">/</span><span class="n">l1_example4</span><span class="o">.</span><span class="n">yaml</span>  \
   <span class="n">rfi_configs</span><span class="o">/</span><span class="n">rfi_production_v1</span><span class="o">.</span><span class="n">json</span>  \
   <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">bonsai_configs</span><span class="o">/</span><span class="n">bonsai_production_ups_nbeta2_v2</span><span class="o">.</span><span class="n">hdf5</span>  \
   <span class="n">l1b_config_placeholder</span>
</pre></div>
</div>
<p>and wait for it to finish initializing (takes around 1 minute).</p>
</li>
<li><p class="first">On <code class="docutils literal"><span class="pre">frb-compute-0</span></code>, start the L0 simulator:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">ch</span><span class="o">-</span><span class="n">frb</span><span class="o">-</span><span class="n">simulate</span><span class="o">-</span><span class="n">l0</span> <span class="n">l0_configs</span><span class="o">/</span><span class="n">l0_example4</span><span class="o">.</span><span class="n">yaml</span> <span class="mi">1200</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="l1_config_reference/index.html" class="btn btn-neutral float-right" title="Config reference: L1 server" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="l1_streams.html" class="btn btn-neutral" title="L1 streams" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>